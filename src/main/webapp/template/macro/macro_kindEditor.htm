<#macro kindEditor>
<script src="/js/jquery.loadmask.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/js/swfupload/swfupload.js"></script>
<script type="text/javascript" src="/js/swfupload/swfupload.queue.js"></script>
<script type="text/javascript" src="/js/swfupload/fileprogress.js"></script>
<script type="text/javascript" src="/js/swfupload/handlers_cn.js"></script>
<div id="user_source" class="manager_">
	<div><a href="javascript:;" class="CLOSE" title="关闭窗口"></a></div>
	<div class="content">
		<table width="550px" cellspacing="0" border="0" style="background-color:#fffbe0;">
			<tr>
				<td width="100" class="current TAB" id="my_resource" title="这里显示的是我上传的资源">我的资源库</td>
				<td width="100" class="normal TAB" id="upload_resource" title="从本地上传资源">上传资源</td>
				<td width="350" class="normal2">&nbsp;</td>
			</tr>
			<tr>
				<td	colspan="3" class="content_td">
					<div id="my_resource_div" style="overflow:auto;">
					</div>
					<div class="SWFUPLOAD" id="upload_resource_div" style="display:none;overflow:auto;">
							<div style="text-align:left;">
								欢迎使用雨无声文件上传组件。本组件可以多文件同时上传，一次最多可以同时上传10个文件。<br />
								<font color=#a50100>允许上传的图片类型：jpg [2M] , gif [2M] , png [1M] , bmp [1M]</font><br />
								<font color="#a50100">允许上传mp3,文件大小不能超过 10 M</font>
								<br /><br />
								<span style="font-weight:bold;">文件上传成功后，在“资源管理器”中刷新第一页就可以看到最新上传的文件</span>
								<br /><br />
							</div>
								<div style="text-align:left;">
									<span id="spanButtonPlaceHolder"></span>
									<input id="btnCancel" type="button" value="取消全部" onclick="swfu.cancelQueue();" disabled="disabled" style="margin-left: 2px; font-size: 8pt; height: 29px;" />
								</div>
								<div id="divStatus"></div>
								<div class="fieldset flash" id="fsUploadProgress">
								<span class="legend">上传列表</span>
								</div>
					</div>
				</td>
			</tr>
		</table>
	</div>
</div>
		<table width="830" border="0" align="center" cellpadding="0" cellspacing="0" class="botom_line">
						<tr align="center" class="botom_line">
							<td width="125" height="270" valign="middle" class="right_line">
								内容：
								<br />
								<br />
								5-20000字符
								<br />
								内容支持ＵＢＢ标签
								<br />
								使用方法请参考帮助
								<br />
								按Ctrl+Enter快速提交
							</td>
							<td align="left" style="padding:5px 0 5px 5px;">
								<textarea id="content" name="model.content"  style=" width:100%; height:300px;"><#nested /></textarea>
							</td>
						</tr>
							<tr align="center">
								<td valign="middle" width="125" height="50" class="right_line">
									插入表情
								</td>
								<td align="left" id="em_table">
									<table border="0" cellspacing="3">
										<tr>
											<td width="25">
												<img src="/images/face/2.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/26.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/3.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/4.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/5.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/6.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/7.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/8.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/9.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/10.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/21.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/22.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/23.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/31.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/32.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/33.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/25.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/34.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/35.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/36.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/27.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/28.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/29.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/30.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/37.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/38.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/39.gif" width="20" height="20"  />
											</td>
											<td width="25">
												<img src="/images/face/1.gif" width="20" height="20"  />
											</td>
										</tr>
										<tr>
											<td>
												<img src="/images/face/11.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/12.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/13.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/14.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/15.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/16.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/17.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/18.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/19.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/20.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/face/24.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em46.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em25.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em09.gif" width="20" height="20"  />
											</td>
											<td>
											 	<img src="/images/shortMessage/em11.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/newTopic/email1.gif" width="20" height="20" >
											</td>
											<td>
												<img src="/images/shortMessage/em14.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em15.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em16.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em20.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em34.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em22.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em24.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em36.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em37.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em38.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em43.gif" width="20" height="20"  />
											</td>
											<td>
												<img src="/images/shortMessage/em44.gif" width="20" height="20"  />
											</td>
										</tr>
									</table>
									<table  cellpadding="0" cellspacing="0">
										<tr align="center">
											<td>
												<img src="/images/face/face1.gif"  />
											</td>
											<td>
												<img src="/images/face/face2.gif"  />
											</td>
											<td>
												<img src="/images/face/face3.gif"  />
											</td>
											<td>
												<img src="/images/face/face4.gif"  />
											</td>
											<td>
												<img src="/images/face/face5.gif"  />
											</td>
											<td>
												<img src="/images/face/face6.gif"  />
											</td>
											<td>
												<img src="/images/face/face7.gif"  />
											</td>
											<td>
												<img src="/images/face/face8.gif"  />
											</td>
											<td>
												<img src="/images/face/face9.gif"  />
											</td>
											<td>
												<img src="/images/face/face10.gif"  />
											</td>
											<td>
												<img src="/images/face/face11.gif"  />
											</td>
											<td>
												<img src="/images/face/face12.gif"  />
											</td>
											<td>
												<img src="/images/face/face13.gif"  />
											</td>
											<td>
												<img src="/images/face/face14.gif"  />
											</td>
											<td>
												<img src="/images/face/face15.gif"  />
											</td>
											<td>
												<img src="/images/face/face16.gif"  />
											</td>
										</tr>
									</table>
									<table cellpadding="0" cellspacing="0">
										
											<tr align="center">
											<td>
												<img src="/images/face/tusiji/1.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/2.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/3.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/4.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/5.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/6.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/7.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/8.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/9.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/10.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/11.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/12.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/13.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/14.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/15.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/tusiji/16.gif" width="44" height="44" />
											</td>
										</tr>
										
										<tr align="center">
											<td>
												<img src="/images/face/ali/1.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/2.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/3.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/4.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/5.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/6.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/7.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/8.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/9.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/10.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/11.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/12.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/13.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/14.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/15.gif" width="44" height="44" />
											</td>
											<td>
												<img src="/images/face/ali/16.gif" width="44" height="44" />
											</td>
										</tr>
									
									</table>
								</td>
							</tr>
					</table>
<script charset="utf-8" src="/kindEditer/kindeditor-newgxu.js"></script>
<script charset="utf-8" src="/kindEditer/lang/zh_CN.js"></script>
<script>
	

		var kindEditor;
		var swfu;
		//add by:集成显卡
		var newgxuEditerMenu=function(){
			$j(".ke-toolbar").css("position", "relative").append($j('<span/>')
				.attr({"unselectable": "on","title": "欢迎来到雨无声论坛","id": 'my_resource_link'})
				.addClass("ke-inline-block")
				.css({width: '40px',height: '40px','background-image': 'url(/kindEditer/newgxu-logo1.gif)',position: 'absolute',cursor:'pointer',top: '0px',right: '0px'
			}).click(function(){}));
			//添加表情事件
			$j("#em_table").find("img").css({border:"none",cursor:"pointer"}).hover(function(){$j(this).css('background-color',"#92cf28")},function(){$j(this).css('background-color',"#ffffff")})
			.unbind("click").click(addLocalEmoticon);
			SERVICE.init(${status.userId},'${session.id}');
		}
		var submited=false;
		var submitContent=function(){
			if(!submited){
				try{submitTopic();}catch(e){submitReply();}
			}
		}
		var addLocalEmoticon=function(){
			if(kindEditor)
				kindEditor.insertHtml('<img src="'+$j(this).attr("src")+'" border="0" alt="" />').focus();
			else alert('编辑器无效，请刷新页面！');
		}
		var localImage=function(){
			//alert(1);
			$j("#my_resource_link").trigger("click");
		}		
	var dodo=function(file, serverData){
		try{
		alert(serverData);
		var d=JSON.parse(serverData);
		alert(d.url);
		if(kindEditor){
			var src=d.url.toLowerCase();
			if(src.indexOf("jpg")>-1||src.indexOf("gif")>-1||src.indexOf("png")>-1||src.indexOf("bmp")>-1||src.indexOf("jpg")>-1){
				kindEditor.insertHtml('<img src="'+d.url+'" border="0" alt="" />').focus();
			}else if(src.indexOf("mp3")>-1){
				kindEditor.insertHtml("[mp=500,300]"+d.url+"[/mp]").focus();
			}else
				kindEditor.insertHtml("<img src='images/zip_icon.gif'/>[url="+d.url+"]点击下载[/url]").focus();
		}else alert('编辑器无效，请刷新页面！');
		}catch(e){alert(e);}
	}
		$j(document).ready(function(){
			try{
				KindEditor.ready(function(K) {
					kindEditor=K.create('#content', {
						// 设置br换行，取代原来的p换行， 2012-03-27
						newlineTag : 'br',
						themeType : 'newgxu',
						shadowMode:false,resizeType:1,
						syncType : '', allowPreviewEmoticons : true,
						allowFlashUpload:false,
						allowMediaUpload:true,allowUpload : true,uploadJson : '/upload_servlet',
						afterCreate:newgxuEditerMenu
					});
				});
			}
			catch(e){alert(e);}
			});

	</script>
</#macro>